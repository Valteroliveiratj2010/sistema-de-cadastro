<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Debug Bot√£o Adicionar Produto</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>üîç Teste Debug - Bot√£o Adicionar Produto</h1>
        
        <div class="card">
            <div class="card-header">
                <h5>Teste do Modal de Venda</h5>
            </div>
            <div class="card-body">
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#saleModal">
                    <i class="bi bi-plus-circle me-2"></i>Abrir Modal de Venda
                </button>
            </div>
        </div>

        <div class="card mt-3">
            <div class="card-header">
                <h5>Logs de Debug</h5>
            </div>
            <div class="card-body">
                <div id="debugLogs" class="bg-dark text-light p-3 rounded" style="height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px;">
                    <div>üîÑ Aguardando logs...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Venda -->
    <div class="modal fade" id="saleModal" tabindex="-1" aria-labelledby="saleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="saleModalLabel">Nova Venda</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="saleForm" data-action="createSale">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="saleClient" class="form-label">Cliente</label>
                                <select class="form-control" id="saleClient" name="clienteId" required>
                                    <option value="">Selecione um cliente</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="saleDate" class="form-label">Data da Venda</label>
                                <input type="date" class="form-control" id="saleDate" name="dataVenda" required>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">Produtos da Venda</div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-5">
                                        <label for="productSelect" class="form-label">Produto</label>
                                        <select class="form-control" id="productSelect" style="width: 100%;">
                                            <option value="">Selecione um produto</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <label for="productQuantity" class="form-label">Qtd</label>
                                        <input type="number" class="form-control" id="productQuantity" value="1" min="1">
                                    </div>
                                    <div class="col-md-3">
                                        <label for="productUnitPrice" class="form-label">Pre√ßo Unit.</label>
                                        <input type="number" step="0.01" class="form-control" id="productUnitPrice" placeholder="Pre√ßo">
                                    </div>
                                    <div class="col-md-2 d-flex align-items-end">
                                        <button type="button" class="btn btn-primary" id="btnAddProduct" title="Adicionar Produto">
                                            <i class="fas fa-plus me-2"></i>Adicionar
                                        </button>
                                    </div>
                                </div>
                                <div id="productDetailsDisplay" class="text-muted small mt-2 text-start"></div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="saleTotalValueDisplay" class="form-label">Valor Total da Venda</label>
                                <input type="text" class="form-control fw-bold" id="saleTotalValueDisplay" readonly value="R$ 0,00">
                                <input type="hidden" id="saleTotalValue" value="0">
                            </div>
                        </div>
                        
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Salvar Venda</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Lista de Produtos -->
    <div class="list-group mt-3" id="saleProductsList">
        <p class="text-muted text-center m-0">Nenhum produto adicionado.</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/apiConfig.js"></script>
    <script src="js/api.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        // Interceptar console.log para mostrar no debug
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        function addToDebugLog(message, type = 'log') {
            const debugLogs = document.getElementById('debugLogs');
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'warn' ? '#ffd93d' : '#6bcf7f';
            
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: ${color}">[${timestamp}]</span> ${message}`;
            debugLogs.appendChild(logEntry);
            debugLogs.scrollTop = debugLogs.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToDebugLog(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToDebugLog(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToDebugLog(args.join(' '), 'warn');
        };
        
        // Teste manual do bot√£o
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ P√°gina carregada, iniciando teste...');
            
            // Aguardar um pouco para o app.js carregar
            setTimeout(() => {
                console.log('üîç Verificando se setupSaleFormEvents existe:', typeof setupSaleFormEvents);
                console.log('üîç Verificando se addProductToSale existe:', typeof addProductToSale);
                
                // Testar clique manual no bot√£o
                const btnAddProduct = document.getElementById('btnAddProduct');
                if (btnAddProduct) {
                    console.log('‚úÖ Bot√£o btnAddProduct encontrado');
                    console.log('üîç Verificando eventos do bot√£o...');
                    
                    // Simular dados de teste
                    const productSelect = document.getElementById('productSelect');
                    const quantityInput = document.getElementById('productQuantity');
                    const priceInput = document.getElementById('productUnitPrice');
                    
                    if (productSelect && quantityInput && priceInput) {
                        console.log('‚úÖ Campos encontrados, simulando dados...');
                        
                        // Adicionar op√ß√£o de teste
                        const option = document.createElement('option');
                        option.value = 'test-1';
                        option.textContent = 'Produto Teste - R$ 10,00';
                        option.dataset.price = '10.00';
                        productSelect.appendChild(option);
                        
                        // Selecionar produto
                        productSelect.value = 'test-1';
                        quantityInput.value = '2';
                        priceInput.value = '10.00';
                        
                        console.log('‚úÖ Dados de teste configurados');
                        console.log('üéØ Clique no bot√£o "Adicionar" para testar!');
                    }
                } else {
                    console.error('‚ùå Bot√£o btnAddProduct n√£o encontrado!');
                }
            }, 2000);
        });
    </script>
</body>
</html> 