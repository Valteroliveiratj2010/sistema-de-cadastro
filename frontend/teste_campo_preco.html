<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Campo Pre√ßo - Modal Vendas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        .test-section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .test-result { margin-top: 10px; padding: 10px; border-radius: 4px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">üîß Teste Campo Pre√ßo - Modal Vendas</h1>
        
        <div class="test-section">
            <h3>üìã Teste 1: Verificar Campo Pre√ßo no HTML</h3>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#saleModal">
                Abrir Modal de Vendas
            </button>
            <div id="test1-result" class="test-result"></div>
        </div>

        <div class="test-section">
            <h3>üîç Teste 2: Verificar JavaScript</h3>
            <button class="btn btn-info" onclick="testarCampoPreco()">
                Testar Campo Pre√ßo
            </button>
            <div id="test2-result" class="test-result"></div>
        </div>

        <div class="test-section">
            <h3>üéØ Teste 3: Simular Sele√ß√£o de Produto</h3>
            <button class="btn btn-success" onclick="simularSelecaoProduto()">
                Simular Sele√ß√£o
            </button>
            <div id="test3-result" class="test-result"></div>
        </div>

        <div class="test-section">
            <h3>üìä Logs de Debug</h3>
            <div id="debug-logs" class="test-result info" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
    </div>

    <!-- Modal de Vendas (c√≥pia do original) -->
    <div class="modal fade" id="saleModal" tabindex="-1" aria-labelledby="saleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" style="max-width: 600px !important; width: 600px !important;">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="saleModalLabel">Nova Venda</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="saleForm" data-action="createSale">
                        <input type="hidden" id="saleId">
                        <div class="mb-3">
                            <label for="saleClient" class="form-label">Cliente</label>
                            <select class="form-select" id="saleClient" required>
                                <option value="">Selecione um cliente</option>
                                <option value="1">Cliente Teste 1</option>
                                <option value="2">Cliente Teste 2</option>
                            </select>
                        </div>
                        <div class="card mb-3">
                            <div class="card-header">Produtos da Venda</div>
                            <div class="card-body">
                                <div id="saleProductsList" class="mb-2" style="max-height: 150px; overflow-y: auto;">
                                    <p class="text-muted text-center m-0">Nenhum produto adicionado.</p>
                                </div>
                                <div class="row g-2 align-items-end">
                                    <div class="col-md-5">
                                        <label for="productSelect" class="form-label">Produto</label>
                                        <select class="form-control" id="productSelect" style="width: 100%;">
                                            <option value="">Selecione um produto</option>
                                            <option value="1" data-price="10.50">Produto 1 - R$ 10,50</option>
                                            <option value="2" data-price="25.00">Produto 2 - R$ 25,00</option>
                                        </select>
                                    </div>
                                    <div class="col-md-2">
                                        <label for="productQuantity" class="form-label">Qtd</label>
                                        <input type="number" class="form-control" id="productQuantity" value="1" min="1">
                                    </div>
                                    <div class="col-md-5">
                                        <label for="productUnitPrice" class="form-label">Pre√ßo Unit.</label>
                                        <input type="number" step="0.01" class="form-control" id="productUnitPrice" placeholder="Pre√ßo">
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-12">
                                        <button type="button" class="btn btn-primary" id="btnAddProduct">
                                            <i class="fas fa-plus me-2"></i>Adicionar Produto
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer mt-3">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Salvar Venda</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function log(message) {
            const logsDiv = document.getElementById('debug-logs');
            const timestamp = new Date().toLocaleTimeString();
            logsDiv.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            console.log(message);
        }

        function testarCampoPreco() {
            log('üîç Iniciando teste do campo pre√ßo...');
            
            const priceInput = document.getElementById('productUnitPrice');
            if (!priceInput) {
                document.getElementById('test2-result').innerHTML = '<div class="error">‚ùå Campo productUnitPrice n√£o encontrado</div>';
                return;
            }

            log('‚úÖ Campo productUnitPrice encontrado');
            
            // Verificar atributos
            const isReadonly = priceInput.hasAttribute('readonly');
            const isDisabled = priceInput.disabled;
            const type = priceInput.type;
            const step = priceInput.step;
            
            log(`üìä Atributos do campo:`);
            log(`   - readonly: ${isReadonly}`);
            log(`   - disabled: ${isDisabled}`);
            log(`   - type: ${type}`);
            log(`   - step: ${step}`);

            // Testar se √© edit√°vel
            const originalValue = priceInput.value;
            priceInput.value = '99.99';
            const canEdit = priceInput.value === '99.99';
            priceInput.value = originalValue;

            log(`‚úèÔ∏è Campo edit√°vel: ${canEdit}`);

            let result = '<div class="success">‚úÖ Campo encontrado e configurado corretamente</div>';
            if (isReadonly) {
                result = '<div class="error">‚ùå Campo est√° readonly</div>';
            } else if (isDisabled) {
                result = '<div class="error">‚ùå Campo est√° disabled</div>';
            } else if (!canEdit) {
                result = '<div class="error">‚ùå Campo n√£o √© edit√°vel</div>';
            }

            document.getElementById('test2-result').innerHTML = result;
        }

        function simularSelecaoProduto() {
            log('üéØ Simulando sele√ß√£o de produto...');
            
            const productSelect = document.getElementById('productSelect');
            const priceInput = document.getElementById('productUnitPrice');
            
            if (!productSelect || !priceInput) {
                document.getElementById('test3-result').innerHTML = '<div class="error">‚ùå Elementos n√£o encontrados</div>';
                return;
            }

            // Simular sele√ß√£o do primeiro produto
            productSelect.value = '1';
            productSelect.dispatchEvent(new Event('change'));
            
            log('‚úÖ Evento change disparado');
            
            setTimeout(() => {
                const currentValue = priceInput.value;
                log(`üí∞ Valor atual do campo pre√ßo: ${currentValue}`);
                
                // Testar se pode editar ap√≥s sele√ß√£o
                const originalValue = priceInput.value;
                priceInput.value = '15.75';
                const canEditAfterSelection = priceInput.value === '15.75';
                priceInput.value = originalValue;
                
                log(`‚úèÔ∏è Edit√°vel ap√≥s sele√ß√£o: ${canEditAfterSelection}`);
                
                let result = '<div class="success">‚úÖ Sele√ß√£o funcionando e campo edit√°vel</div>';
                if (!canEditAfterSelection) {
                    result = '<div class="error">‚ùå Campo n√£o edit√°vel ap√≥s sele√ß√£o</div>';
                }
                
                document.getElementById('test3-result').innerHTML = result;
            }, 100);
        }

        // Configurar evento de mudan√ßa do produto
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ P√°gina carregada, configurando eventos...');
            
            const productSelect = document.getElementById('productSelect');
            if (productSelect) {
                productSelect.addEventListener('change', function() {
                    const selectedOption = this.options[this.selectedIndex];
                    const priceInput = document.getElementById('productUnitPrice');
                    
                    log(`üîÑ Produto selecionado: ${selectedOption ? selectedOption.textContent : 'Nenhum'}`);
                    
                    if (selectedOption && selectedOption.dataset.price) {
                        priceInput.value = selectedOption.dataset.price;
                        log(`üí∞ Pre√ßo definido: ${selectedOption.dataset.price}`);
                    } else {
                        priceInput.value = '';
                        log(`üßπ Campo pre√ßo limpo`);
                    }
                });
                
                log('‚úÖ Evento change configurado para productSelect');
            }
            
            // Verificar campo pre√ßo inicial
            const priceInput = document.getElementById('productUnitPrice');
            if (priceInput) {
                log(`üìä Estado inicial do campo pre√ßo:`);
                log(`   - readonly: ${priceInput.hasAttribute('readonly')}`);
                log(`   - disabled: ${priceInput.disabled}`);
                log(`   - value: "${priceInput.value}"`);
            }
        });
    </script>
</body>
</html> 