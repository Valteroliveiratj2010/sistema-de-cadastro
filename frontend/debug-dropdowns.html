<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Dropdowns - Gestor PRO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container mt-5">
        <h1>üîç Debug dos Dropdowns - Gestor PRO</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Teste de Clientes</h5>
                    </div>
                    <div class="card-body">
                        <label for="testClientSelect" class="form-label">Selecionar Cliente</label>
                        <select class="form-control" id="testClientSelect">
                            <option value="">Carregando...</option>
                        </select>
                        <div class="mt-2">
                            <button class="btn btn-primary btn-sm" onclick="loadClients()">Carregar Clientes</button>
                            <button class="btn btn-info btn-sm" onclick="checkClientSelect()">Verificar Select</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Teste de Produtos</h5>
                    </div>
                    <div class="card-body">
                        <label for="testProductSelect" class="form-label">Selecionar Produto</label>
                        <select class="form-control" id="testProductSelect">
                            <option value="">Carregando...</option>
                        </select>
                        <div class="mt-2">
                            <button class="btn btn-primary btn-sm" onclick="loadProducts()">Carregar Produtos</button>
                            <button class="btn btn-info btn-sm" onclick="checkProductSelect()">Verificar Select</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Logs de Debug</h5>
                    </div>
                    <div class="card-body">
                        <div id="debugLog" style="height: 300px; overflow-y: auto; background: #f8f9fa; padding: 1rem; font-family: monospace; font-size: 0.875rem;">
                            Aguardando logs...
                        </div>
                        <button class="btn btn-secondary btn-sm mt-2" onclick="clearLog()">Limpar Log</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Teste de Token</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-warning" onclick="checkToken()">Verificar Token</button>
                        <button class="btn btn-success" onclick="testAPI()">Testar API</button>
                        <div id="tokenInfo" class="mt-2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    
    <script>
        // Fun√ß√£o para adicionar logs
        function addLog(message) {
            const logDiv = document.getElementById('debugLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        function clearLog() {
            document.getElementById('debugLog').innerHTML = 'Log limpo...<br>';
        }
        
        // Verificar token
        function checkToken() {
            const token = localStorage.getItem('token');
            const tokenInfo = document.getElementById('tokenInfo');
            
            if (token) {
                tokenInfo.innerHTML = `
                    <div class="alert alert-success">
                        <strong>‚úÖ Token encontrado!</strong><br>
                        Tamanho: ${token.length} caracteres<br>
                        Preview: ${token.substring(0, 20)}...
                    </div>
                `;
                addLog('‚úÖ Token encontrado no localStorage');
            } else {
                tokenInfo.innerHTML = `
                    <div class="alert alert-danger">
                        <strong>‚ùå Token n√£o encontrado!</strong><br>
                        Fa√ßa login primeiro.
                    </div>
                `;
                addLog('‚ùå Token n√£o encontrado no localStorage');
            }
        }
        
        // Testar API
        async function testAPI() {
            addLog('üß™ Testando API...');
            
            const token = localStorage.getItem('token');
            if (!token) {
                addLog('‚ùå Token n√£o encontrado para teste da API');
                return;
            }
            
            try {
                // Testar endpoint de clientes
                addLog('üì° Testando endpoint de clientes...');
                const clientsResponse = await fetch('https://sistema-de-cadastro-backend.onrender.com/api/clients?page=1&q=&limit=5', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                addLog(`üìä Status clientes: ${clientsResponse.status}`);
                
                if (clientsResponse.ok) {
                    const clientsData = await clientsResponse.json();
                    addLog(`‚úÖ Clientes carregados: ${clientsData.data ? clientsData.data.length : 0} registros`);
                    if (clientsData.data && clientsData.data.length > 0) {
                        addLog(`üìã Primeiro cliente: ${clientsData.data[0].nome}`);
                    }
                } else {
                    const errorText = await clientsResponse.text();
                    addLog(`‚ùå Erro clientes: ${errorText}`);
                }
                
                // Testar endpoint de produtos
                addLog('üì° Testando endpoint de produtos...');
                const productsResponse = await fetch('https://sistema-de-cadastro-backend.onrender.com/api/products?page=1&q=&limit=5', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                addLog(`üìä Status produtos: ${productsResponse.status}`);
                
                if (productsResponse.ok) {
                    const productsData = await productsResponse.json();
                    addLog(`‚úÖ Produtos carregados: ${productsData.data ? productsData.data.length : 0} registros`);
                    if (productsData.data && productsData.data.length > 0) {
                        addLog(`üìã Primeiro produto: ${productsData.data[0].nome}`);
                    }
                } else {
                    const errorText = await productsResponse.text();
                    addLog(`‚ùå Erro produtos: ${errorText}`);
                }
                
            } catch (error) {
                addLog(`‚ùå Erro no teste da API: ${error.message}`);
            }
        }
        
        // Carregar clientes
        async function loadClients() {
            addLog('üîÑ Carregando clientes...');
            
            const token = localStorage.getItem('token');
            if (!token) {
                addLog('‚ùå Token n√£o encontrado');
                return;
            }
            
            try {
                const response = await fetch('https://sistema-de-cadastro-backend.onrender.com/api/clients?page=1&q=&limit=100', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const clients = data.data || [];
                    
                    addLog(`‚úÖ ${clients.length} clientes carregados`);
                    
                    // Limpar e popular o select
                    const select = document.getElementById('testClientSelect');
                    select.innerHTML = '<option value="">Selecione um cliente</option>';
                    
                    clients.forEach(client => {
                        const option = document.createElement('option');
                        option.value = client.id;
                        option.textContent = client.nome;
                        select.appendChild(option);
                    });
                    
                    addLog('‚úÖ Select de clientes populado');
                    
                } else {
                    addLog(`‚ùå Erro ao carregar clientes: ${response.status}`);
                }
                
            } catch (error) {
                addLog(`‚ùå Erro: ${error.message}`);
            }
        }
        
        // Carregar produtos
        async function loadProducts() {
            addLog('üîÑ Carregando produtos...');
            
            const token = localStorage.getItem('token');
            if (!token) {
                addLog('‚ùå Token n√£o encontrado');
                return;
            }
            
            try {
                const response = await fetch('https://sistema-de-cadastro-backend.onrender.com/api/products?page=1&q=&limit=100', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const products = data.data || [];
                    
                    addLog(`‚úÖ ${products.length} produtos carregados`);
                    
                    // Limpar e popular o select
                    const select = document.getElementById('testProductSelect');
                    select.innerHTML = '<option value="">Selecione um produto</option>';
                    
                    products.forEach(product => {
                        const option = document.createElement('option');
                        option.value = product.id;
                        option.textContent = `${product.nome} - R$ ${product.precoVenda || 0}`;
                        select.appendChild(option);
                    });
                    
                    addLog('‚úÖ Select de produtos populado');
                    
                } else {
                    addLog(`‚ùå Erro ao carregar produtos: ${response.status}`);
                }
                
            } catch (error) {
                addLog(`‚ùå Erro: ${error.message}`);
            }
        }
        
        // Verificar selects
        function checkClientSelect() {
            const select = document.getElementById('testClientSelect');
            addLog(`üìã Select de clientes: ${select.options.length} op√ß√µes`);
            addLog(`üìã Valor selecionado: ${select.value}`);
        }
        
        function checkProductSelect() {
            const select = document.getElementById('testProductSelect');
            addLog(`üìã Select de produtos: ${select.options.length} op√ß√µes`);
            addLog(`üìã Valor selecionado: ${select.value}`);
        }
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üöÄ P√°gina carregada');
            addLog('üîç Verificando token...');
            checkToken();
        });
    </script>
</body>
</html> 