<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste: Corre√ß√£o do Eixo Y</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background: #f8f9fa; }
        .test-container { max-width: 1200px; margin: 0 auto; }
        .chart-test { background: white; border-radius: 8px; padding: 20px; margin: 20px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .success { color: #059669; font-weight: bold; }
        .error { color: #DC2626; font-weight: bold; }
        .warning { color: #D97706; font-weight: bold; }
        .info { color: #2563EB; font-weight: bold; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>‚úÖ Teste: Corre√ß√£o do Eixo Y</h1>
        <p>Verificando se o eixo Y agora mostra os valores corretos sem formata√ß√£o de moeda.</p>
        
        <div class="alert alert-success">
            <h6>üîß Problema Corrigido:</h6>
            <ul>
                <li><strong>Problema:</strong> Eixo Y mostrava "0,00 ‚Ç¨" at√© "1600,00 ‚Ç¨"</li>
                <li><strong>Dados reais:</strong> Julho: R$ 1.500,00, Agosto: R$ 400,00</li>
                <li><strong>Solu√ß√£o:</strong> Removida formata√ß√£o de moeda dos ticks do eixo Y</li>
                <li><strong>Resultado esperado:</strong> Eixo Y mostra: 0, 400, 800, 1200, 1600</li>
            </ul>
        </div>
        
        <div class="chart-test">
            <h4>üìä Gr√°fico com Eixo Y Corrigido</h4>
            <canvas id="salesChart" height="300"></canvas>
        </div>
        
        <div class="row">
            <div class="col-md-6">
                <div class="alert alert-info">
                    <h6>üìä Valores Reais da API:</h6>
                    <div id="apiValues">üîÑ Verificando...</div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="alert alert-info">
                    <h6>üìà Valores do Eixo Y:</h6>
                    <div id="yAxisValues">üîÑ Verificando...</div>
                </div>
            </div>
        </div>
        
        <div class="alert alert-secondary">
            <h6>üîç O que foi alterado:</h6>
            <div class="code-block" style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace;">
                <div><strong>Antes:</strong></div>
                <div>callback: function(value) {</div>
                <div>  if (window.i18n) {</div>
                <div>    return window.i18n.formatCurrency(value);</div>
                <div>  }</div>
                <div>  return 'R$ ' + value.toFixed(0);</div>
                <div>}</div>
                <br>
                <div><strong>Depois:</strong></div>
                <div>callback: function(value) {</div>
                <div>  // Mostrar apenas o valor num√©rico sem formata√ß√£o de moeda</div>
                <div>  return value.toLocaleString('pt-BR');</div>
                <div>}</div>
            </div>
        </div>
        
        <div class="mt-4">
            <button class="btn btn-primary" onclick="testarEixoY()">
                üîç Testar Eixo Y
            </button>
            <button class="btn btn-success" onclick="abrirDashboard()">
                üìä Abrir Dashboard
            </button>
            <button class="btn btn-warning" onclick="limparCache()">
                üßπ Limpar Cache
            </button>
        </div>
        
        <div class="mt-4">
            <h5>üéØ Resultado Esperado:</h5>
            <div class="alert alert-success">
                <ul>
                    <li><strong>Eixo Y limpo:</strong> Mostra apenas n√∫meros: 0, 400, 800, 1200, 1600</li>
                    <li><strong>Sem s√≠mbolos:</strong> N√£o mostra "‚Ç¨" ou "R$" nos valores do eixo</li>
                    <li><strong>Valores corretos:</strong> Julho: ~1500, Agosto: ~400</li>
                    <li><strong>Formata√ß√£o brasileira:</strong> Usa v√≠rgula como separador decimal</li>
                </ul>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/api.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/i18n/i18n.js"></script>
    <script src="js/app.js?v=2.0"></script>
    
    <script>
        async function testarEixoY() {
            console.log('üîç === TESTE DO EIXO Y ===');
            
            try {
                // 1. Buscar dados da API
                console.log('üåê Buscando dados da API...');
                const response = await api.get('/dashboard/stats');
                console.log('üìä Resposta da API:', response);
                
                if (response && response.salesByMonth) {
                    const salesData = response.salesByMonth;
                    const valuesWithData = salesData.filter(item => item.total > 0);
                    
                    document.getElementById('apiValues').innerHTML = `
                        <div class="success">‚úÖ Dados encontrados</div>
                        <div><strong>Total de registros:</strong> ${salesData.length}</div>
                        <div><strong>Registros com dados:</strong> ${valuesWithData.length}</div>
                        <div><strong>Valores reais:</strong></div>
                        ${valuesWithData.map(item => `<div>‚Ä¢ ${item.month}: R$ ${item.total.toFixed(2)}</div>`).join('')}
                    `;
                } else {
                    document.getElementById('apiValues').innerHTML = '<div class="error">‚ùå Nenhum dado encontrado</div>';
                }
                
                // 2. Aguardar renderiza√ß√£o e verificar eixo Y
                setTimeout(() => {
                    verificarEixoY();
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå Erro no teste:', error);
                document.getElementById('apiValues').innerHTML = `<div class="error">‚ùå Erro: ${error.message}</div>`;
            }
        }
        
        function verificarEixoY() {
            console.log('üîç Verificando eixo Y...');
            
            const canvas = document.getElementById('salesChart');
            if (!canvas) {
                document.getElementById('yAxisValues').innerHTML = '<div class="error">‚ùå Canvas n√£o encontrado</div>';
                return;
            }
            
            const chart = Chart.getChart(canvas);
            if (chart && chart.options && chart.options.scales && chart.options.scales.y) {
                const yAxis = chart.options.scales.y;
                const ticks = yAxis.ticks;
                
                if (ticks && ticks.callback) {
                    // Testar alguns valores
                    const testValues = [0, 400, 800, 1200, 1600];
                    const formattedValues = testValues.map(value => ticks.callback(value));
                    
                    console.log('üìä Valores do eixo Y:', formattedValues);
                    
                    // Verificar se n√£o tem s√≠mbolos de moeda
                    const hasCurrencySymbols = formattedValues.some(value => 
                        value.includes('‚Ç¨') || value.includes('R$') || value.includes('$')
                    );
                    
                    if (!hasCurrencySymbols) {
                        document.getElementById('yAxisValues').innerHTML = `
                            <div class="success">‚úÖ Eixo Y corrigido</div>
                            <div><strong>Valores:</strong> ${formattedValues.join(', ')}</div>
                            <div><strong>Sem s√≠mbolos de moeda:</strong> ‚úÖ</div>
                            <div><strong>Formata√ß√£o brasileira:</strong> ‚úÖ</div>
                        `;
                    } else {
                        document.getElementById('yAxisValues').innerHTML = `
                            <div class="warning">‚ö†Ô∏è Eixo Y ainda tem s√≠mbolos de moeda</div>
                            <div><strong>Valores:</strong> ${formattedValues.join(', ')}</div>
                        `;
                    }
                } else {
                    document.getElementById('yAxisValues').innerHTML = '<div class="error">‚ùå Callback do eixo Y n√£o encontrado</div>';
                }
            } else {
                document.getElementById('yAxisValues').innerHTML = '<div class="error">‚ùå Configura√ß√£o do eixo Y n√£o encontrada</div>';
            }
        }
        
        function abrirDashboard() {
            window.open('index.html', '_blank');
        }
        
        function limparCache() {
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    for (let name of names) {
                        caches.delete(name);
                    }
                });
            }
            alert('Cache limpo! Recarregando p√°gina...');
            location.reload();
        }
        
        // Teste autom√°tico ao carregar
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ P√°gina carregada, iniciando teste do eixo Y...');
            setTimeout(testarEixoY, 1000);
        });
    </script>
</body>
</html> 